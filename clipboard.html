<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anonymous Message Board</title>
    <style>
        #messages {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f9f9f9;
        }
        .message {
            padding: 5px;
            border-bottom: 1px solid #ddd;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>Anonymous Message Board</h1>
    <div id="messages"></div>
    <textarea id="messageInput" placeholder="Type a message..."></textarea>
    <br>
    <button onclick="postMessage()">Post Message</button>
    <p id="status"></p>

    <script>
        // Replace these placeholders with your actual values
        const GITHUB_TOKEN = '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';
        const GIST_ID = 'd7e5242be9ba4317951d62e1d0db7251';

        // Load all messages when the page loads
        window.onload = loadMessages;

        async function loadMessages() {
            try {
                const response = await fetch(`https://api.github.com/gists/${d7e5242be9ba4317951d62e1d0db7251}`, {
                    headers: {
                        'Authorization': `token ${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}`
                    }
                });
                
                if (response.ok) {
                    const gist = await response.json();
                    const content = gist.files['messages.txt'].content;
                    const messages = content.split('\n'); // Split messages by newline
                    displayMessages(messages);
                    document.getElementById('status').innerText = "Messages loaded!";
                } else {
                    document.getElementById('status').innerText = "Error loading messages.";
                }
            } catch (error) {
                document.getElementById('status').innerText = "Failed to load messages.";
                console.error(error);
            }
        }

        function displayMessages(messages) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = ''; // Clear previous messages
            messages.forEach(message => {
                if (message.trim()) { // Only display non-empty lines
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message';
                    messageDiv.textContent = message;
                    messagesDiv.appendChild(messageDiv);
                }
            });
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to the latest message
        }

        async function postMessage() {
            const messageInput = document.getElementById('messageInput');
            const newMessage = messageInput.value.trim();
            
            if (!newMessage) {
                document.getElementById('status').innerText = "Please type a message.";
                return;
            }

            try {
                const response = await fetch(`https://api.github.com/gists/${d7e5242be9ba4317951d62e1d0db7251}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `token ${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}`
                    }
                });

                if (response.ok) {
                    const gist = await response.json();
                    const currentContent = gist.files['messages.txt'].content;
                    const updatedContent = currentContent + '\n' + newMessage; // Append the new message

                    // Save the updated content back to the Gist
                    const saveResponse = await fetch(`https://api.github.com/gists/${d7e5242be9ba4317951d62e1d0db7251}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${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}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            files: {
                                'messages.txt': { content: updatedContent }
                            }
                        })
                    });

                    if (saveResponse.ok) {
                        document.getElementById('status').innerText = "Message posted!";
                        messageInput.value = ''; // Clear the input
                        loadMessages(); // Reload messages to show the new one
                    } else {
                        document.getElementById('status').innerText = "Error posting message.";
                    }
                } else {
                    document.getElementById('status').innerText = "Error loading current messages.";
                }
            } catch (error) {
                document.getElementById('status').innerText = "Failed to post message.";
                console.error(error);
            }
        }
    </script>
</body>
</html>
